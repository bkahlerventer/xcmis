<?xml version="1.0" encoding="ISO-8859-1"?>
<configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.exoplaform.org/xml/ns/kernel_1_0.xsd http://www.exoplaform.org/xml/ns/kernel_1_0.xsd" xmlns="http://www.exoplaform.org/xml/ns/kernel_1_0.xsd">

	<component>
		<key>org.exoplatform.services.log.LogConfigurationInitializer</key>
		<type>org.exoplatform.services.log.LogConfigurationInitializer</type>
		<init-params>
			<value-param>
				<name>logger</name>
				<value>org.slf4j.Logger</value>
			</value-param>
			<value-param>
				<name>configurator</name>
				<value>org.exoplatform.services.log.impl.Log4JConfigurator</value>
			</value-param>
			<properties-param>
				<name>properties</name>
				<description>Log4J properties</description>
				<property name="log4j.rootLogger" value="INFO, stdout, file" />
				<property name="log4j.appender.stdout" value="org.apache.log4j.ConsoleAppender" />
				<property name="log4j.appender.stdout.threshold" value="DEBUG" />
				<property name="log4j.appender.stdout.layout" value="org.apache.log4j.PatternLayout" />
				<property name="log4j.appender.stdout.layout.ConversionPattern" value="%d{dd.MM.yyyy HH:mm:ss} *%-5p* [%t] %c{1}: %m (%F, line %L) %n" />
				<property name="log4j.appender.file" value="org.apache.log4j.FileAppender" />
				<property name="log4j.appender.file.File" value="../logs/jcr.log" />
				<property name="log4j.appender.file.layout" value="org.apache.log4j.PatternLayout" />
				<property name="log4j.appender.file.layout.ConversionPattern" value="%d{dd.MM.yyyy HH:mm:ss} *%-5p* [%t] %c{1}: %m (%F, line %L) %n" />
				<!-- property name="log4j.category.jcr.FileCleaner" value="DEBUG" / -->
				<property name="log4j.category.org.apache.pdfbox" value="WARN" />
			</properties-param>
		</init-params>
	</component>

  <component>
    <type>org.exoplatform.services.rest.ext.proxy.ProxyService</type>
  </component>


	<component>
		<type>org.xcmis.spi.deploy.ExoContainerCmisRegistry</type>
                 <init-params>
			<values-param>
				<name>renditionProviders</name>
				<description>Redition providers classes.</description>
				<value>org.xcmis.renditions.impl.PDFDocumentRenditionProvider</value>
				<value>org.xcmis.renditions.impl.ImageRenditionProvider</value>
			</values-param>
		</init-params>
	</component>

        <component>
           <type>org.xcmis.spi.PermissionService</type>
        </component>
	
	<component>
		<key>org.exoplatform.services.document.DocumentReaderService</key>
		<type>org.xcmis.spi.utils.CmisDocumentReaderService</type>
	</component>
	
	<component>
		<key>org.exoplatform.services.jcr.config.RepositoryServiceConfiguration</key>
		<type>org.exoplatform.services.jcr.impl.config.RepositoryServiceConfigurationImpl</type>
		<init-params>
			<value-param>
				<name>conf-path</name>
				<description>JCR configuration file</description>
				<value>jar:/conf/portal/jcr-cmis-config.xml</value>
			</value-param>
		</init-params>
	</component>

	<!-- Storage Provider JCR eXo-->
	<component>
		<type>org.xcmis.sp.jcr.exo.StorageProviderImpl</type>
		<init-params>
			<object-param>
				<name>configs</name>
				<object type="org.xcmis.sp.jcr.exo.StorageProviderImpl$StorageProviderConfig">
					<field name="storage">
						<object type="org.xcmis.sp.jcr.exo.StorageConfiguration">
							<field name="id">
								<string>cmis1</string>
							</field>
							<field name="repository">
								<string>repository</string>
							</field>
							<field name="workspace">
								<string>cmis</string>
							</field>
							<field name="indexConfiguration">
								<object type="org.xcmis.search.config.IndexConfiguration">
									<field name="indexDir">
										<string>../temp/index/db1/ws1</string>
									</field>
								</object>
							</field>
						</object>
					</field>
				</object>
			</object-param>
		</init-params>
	</component>


   <!-- Storage Provider InMemory -->
   <!-- Do not forget to add xcmis-sp-inmemory-x.y.jar to the webapps/xcmis.war/WEB-INF/lib -->
<!--
	<component>
		<type>org.xcmis.sp.inmemory.StorageProviderImpl</type>
		<init-params>
			<object-param>
				<name>configs</name>
				<object type="org.xcmis.sp.inmemory.StorageProviderImpl$StorageProviderConfig">
					<field name="storage">
						<object type="org.xcmis.sp.inmemory.StorageConfiguration">
							<field name="id">
								<string>cmis-inmem1</string>
							</field>
						</object>
					</field>
				</object>
			</object-param>
		</init-params>
	</component>
-->

	<component>
		<key>org.exoplatform.services.jcr.RepositoryService</key>
		<type>org.exoplatform.services.jcr.impl.RepositoryServiceImpl</type>
	</component>

	<component>
		<type>org.exoplatform.services.jcr.ext.registry.RegistryService</type>
		<init-params>
			<properties-param>
				<name>locations</name>
				<property name="repository" value="production" />
			</properties-param>
		</init-params>
	</component>

	<component>
		<key>org.exoplatform.services.organization.OrganizationService</key>
		<type>org.exoplatform.services.organization.impl.mock.DummyOrganizationService</type>
	</component>

	<component>
		<type>org.exoplatform.services.jcr.ext.registry.RESTRegistryService</type>
	</component>


	<component>
		<key>org.exoplatform.services.jcr.webdav.WebDavServiceImpl</key>
		<type>org.exoplatform.services.jcr.webdav.WebDavServiceImpl</type>
		<init-params>
			<value-param>
				<name>auto-mix-lockable</name>
				<value>false</value>
			</value-param>
			<value-param>
				<name>def-folder-node-type</name>
				<value>nt:folder</value>
			</value-param>
			<value-param>
				<name>def-file-node-type</name>
				<value>nt:file</value>
			</value-param>
			<value-param>
				<name>def-file-mimetype</name>
				<value>text/plain</value>
			</value-param>
			<value-param>
				<name>update-policy</name>
				<value>create-version</value>
			</value-param>
		</init-params>
	</component>

	<external-component-plugins>
		<target-component>org.exoplatform.services.jcr.RepositoryService</target-component>
		<component-plugin>
			<name>add.namespaces</name>
			<set-method>addPlugin</set-method>
			<type>org.exoplatform.services.jcr.impl.AddNamespacesPlugin</type>
			<init-params>
				<properties-param>
					<name>namespaces</name>
					<property name="dc" value="http://purl.org/dc/elements/1.1/" />
					<property name="webdav" value="http://www.exoplatform.org/jcr/webdav" />
				</properties-param>
			</init-params>
		</component-plugin>
		<component-plugin>
			<name>add.nodeType</name>
			<set-method>addPlugin</set-method>
			<type>org.exoplatform.services.jcr.impl.AddNodeTypePlugin</type>
			<init-params>
				<values-param>
					<name>autoCreatedInNewRepository</name>
					<description>Node types configuration file</description>
					<value>jar:/conf/ext-nodetypes-config.xml</value>
					<!--            <value>jar:/conf/organization-nodetypes.xml</value>-->
					<value>jar:/conf/webdav-nodetypes.xml</value>
				</values-param>
			</init-params>
		</component-plugin>
	</external-component-plugins>

	<external-component-plugins>
		<target-component>org.exoplatform.services.naming.InitialContextInitializer</target-component>
		<component-plugin>
			<name>bind.datasource</name>
			<set-method>addPlugin</set-method>
			<type>org.exoplatform.services.naming.BindReferencePlugin</type>
			<init-params>
				<value-param>
					<name>bind-name</name>
					<value>jdbcexo</value>
				</value-param>
				<value-param>
					<name>class-name</name>
					<value>javax.sql.DataSource</value>
				</value-param>
				<value-param>
					<name>factory</name>
					<value>org.apache.commons.dbcp.BasicDataSourceFactory</value>
				</value-param>
				<properties-param>
					<name>ref-addresses</name>
					<description>ref-addresses</description>
					<property name="driverClassName" value="org.hsqldb.jdbcDriver" />
					<property name="url" value="jdbc:hsqldb:file:../temp/data/exodb" />
					<property name="username" value="sa" />
					<property name="password" value="" />
				</properties-param>
			</init-params>
		</component-plugin>
	</external-component-plugins>

</configuration>
